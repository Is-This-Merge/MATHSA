<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>êµìœ¡ê³¼ì •</title>
  <link rel="icon" href="static/image/icon.png">
  <link rel="stylesheet" href="static/css/curriculum.css">
</head>
<body>
  <div class="container">
    <header>
        <div class="header-wrapper">
            <div class="left-section">
                <h1><a href="./index.html" class="logo">ìˆ˜í•™SA</a></h1>
                <p id="Title" class="lead">ê³¼ëª© ì„¤ëª…</p>
            </div>
            <div class="right-section">
                <div id="darkToggle" class="dark-btn">ğŸŒ™</div>
            </div>
        </div>
    </header>

    <main>
      <div>
        <div class="filter">
          <input type="search" id="searchInput" placeholder="ê³¼ëª©ëª… ê²€ìƒ‰">
          <select id="semesterFilter">
            <option value="all">í•™ê¸°</option>
            <option value=1>1í•™ë…„ 1í•™ê¸°</option>
            <option value=2>1í•™ë…„ 2í•™ê¸°</option>
            <option value=3>2í•™ë…„ 1í•™ê¸°</option>
            <option value=4>2í•™ë…„ 2í•™ê¸°</option>
            <option value=5>3í•™ë…„ 1í•™ê¸°</option>
            <option value=6>3í•™ë…„ 2í•™ê¸°</option>
          </select>
          <select id="creditFilter">
            <option value="all">í•™ì </option>
            <option value=2>2í•™ì </option>
            <option value=3>3í•™ì </option>
            <option value=4>3í•™ì </option>
          </select>
          <select id="frequencyFilter">
            <option value="all">ì‹œìˆ˜</option>
            <option value=2>2ì‹œìˆ˜</option>
            <option value=3>3ì‹œìˆ˜</option>
            <option value=4>4ì‹œìˆ˜</option>
          </select>
          <select id="inFilter">
            <option value="all">êµê³¼</option>
            <option value="ì „ë¬¸êµê³¼">ì „ë¬¸êµê³¼</option>
            <option value="ì°½ì˜ìœµí•©êµê³¼">ì°½ì˜ìœµí•©êµê³¼</option>
          </select>
          <select id="necessaryFilter">
            <option value="all">êµ¬ë¶„</option>
            <option value="í•„ìˆ˜">í•„ìˆ˜</option>
            <option value="ê¸°ë³¸ì„ íƒ">ê¸°ë³¸ì„ íƒ</option>
            <option value="ììœ¨ì„ íƒ">ììœ¨ì„ íƒ</option>
          </select>
          <select id="APFilter">
            <option value="all">APìœ ë¬´</option>
            <option value=0>X</option>
            <option value=1>O</option>
          </select>
        </div>
        <div id="card-container" class="card-container">
        </div>
      </div>
    </main>
  </div>
  
  <script src="./static/js/darkmode.js"></script>
  <script src="static/js/curriculum.js"></script>
  <script>
    const params = new URLSearchParams(window.location.search);
    const curriculumCl = parseInt(params.get('cl'), 10);
    const curriculum = curriculums.find(c => c.cl.includes(curriculumCl));
    
    document.title = `${curriculumCl}ê¸° êµìœ¡ê³¼ì •`

    if (curriculum) {
      document.getElementById('Title').innerHTML = `SASA ${curriculumCl}ê¸° ìˆ˜í•™ êµìœ¡ê³¼ì •`;      
    }

    const CardContainer = document.getElementById('card-container');
    const searchInput = document.getElementById('searchInput');
    const semesterFilter = document.getElementById('semesterFilter');
    const creditFilter = document.getElementById('creditFilter');
    const frequencyFilter = document.getElementById('frequencyFilter');
    const inFilter = document.getElementById('inFilter');
    const necessaryFilter = document.getElementById('necessaryFilter');
    const APFilter = document.getElementById('APFilter');    

    function render(list){
      CardContainer.innerHTML = '';
      if(!list.length){
        CardContainer.innerHTML = '<div class="noAnswer">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>'
        return;
      }

      list.forEach(c => {
        const semestertext = c.semester
        .map(s => {
          const grade = Math.floor((s-1)/2)+1;
          const semester = ((s-1)%2)+1;
          return `${grade}í•™ë…„ ${semester}í•™ê¸°`;
        })
        .join(', ');

        const apLabel = c.AP === 1 ? 'AP' : '';

        const item = document.createElement('div');
        item.innerHTML = `
          <a href="./subjects/${c.engname}.html?cl=${curriculumCl}&id=${c.id}" class="card">
            <h2>${c.name}</h2>
            <div>${semestertext}</div>
            <div>${c.credits}í•™ì </div>
            <div>${c.frequency}ì‹œìˆ˜</div>
            <div>${c.in}</div>
            <div>${c.necessary}</div>
            <div>${apLabel}</div>
          </a>
        `;
        CardContainer.appendChild(item);
      })
    }

    function filterAndRender(){
      const sI = searchInput.value.trim().toLowerCase();
      const sF = semesterFilter.value;
      const cF = creditFilter.value;
      const iF = inFilter.value;
      const fF = frequencyFilter.value;
      const nF = necessaryFilter.value;
      const aF = APFilter.value;
      const filtered = curriculum.subjects.filter(c => {
        if(sF !== 'all' && !c.semester.includes(Number(sF))) return false;
        if(cF !== 'all' && Number(cF) !== c.credits) return false;
        if(fF !== 'all' && Number(fF) !== c.frequency) return false;
        if(iF !== 'all' && iF !== c.in) return false;
        if(nF !== 'all' && Number(nF) !== c.necessary) return false;
        if(aF !== 'all' && Number(aF) !== c.AP) return false;
        if(!sI) return true;
        return c.name.toLowerCase().includes(sI);
      });
      render(filtered);
    }

    searchInput.addEventListener('input', filterAndRender);
    semesterFilter.addEventListener('change', filterAndRender);
    creditFilter.addEventListener('change', filterAndRender);
    frequencyFilter.addEventListener('change', filterAndRender);
    inFilter.addEventListener('change', filterAndRender);
    necessaryFilter.addEventListener('change', filterAndRender);
    APFilter.addEventListener('change', filterAndRender);

    filterAndRender();
  </script>
</body>
</html>
